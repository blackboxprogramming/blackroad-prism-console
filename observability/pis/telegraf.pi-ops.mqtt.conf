# Pi Ops MQTT heartbeat Telegraf configuration
# Replace the placeholder values before deploying.

[agent]
  interval = "10s"
  flush_interval = "10s"
  flush_jitter = "5s"
  metric_batch_size = 1000
  metric_buffer_limit = 10000
  collection_jitter = "0s"

[global_tags]
  fleet = "pi-cortex"
  source = "pi-ops"

[[outputs.influxdb_v2]]
  urls = ["http://{INFLUX_HOST}:8086"]
  token = "{INFLUX_TOKEN}"
  organization = "pi-cortex"
  bucket = "telemetry"

[[inputs.mqtt_consumer]]
  servers = ["tcp://{MQTT_HOST}:1883"]
  topics = ["system/heartbeat/+"]
  qos = 1
  connection_timeout = "30s"
  persistent_session = false
  client_id = "telegraf-pi-ops"
  # Leave username/password empty if your broker does not require auth.
  username = "{MQTT_USERNAME}"
  password = "{MQTT_PASSWORD}"
  data_format = "json"
  name_override = "pi_ops_heartbeat"
  tag_keys = ["topic"]
  json_string_fields = ["status", "state", "mode"]
  # Uncomment the lines below if your payload includes a Unix timestamp field.
  # json_time_key = "timestamp"
  # json_time_format = "unix"
  topic_tag = "topic"
