id: SECRET_EXPIRY_CLUSTER
name: Secret expiry clustering
mode: observe
severity: high
owners:
  - "@platform-secrets"
  - "secrets@company.com"
docs_url: https://your.docs/policies/secret_expiry_cluster
metadata:
  product: Secret Hygiene
  description: Cluster secret-expired errors to trigger automated rotation.
expr: rate(error_kind == "secret_expired", "10m") >= 0.3
tests:
  - name: ok_fixture
    fixture: secret/ok.series.json
    want: false
  - name: burst_fixture
    fixture: secret/burst.series.json
    want: true
    expect_details:
      captures:
        rate:
          - secret_ids: ["hash_2f9c", "hash_9a"]
  - name: inline_single
    window: "10m"
    series:
      - { error_kind: "secret_expired", secret_id: "hash_x" }
      - repeat: 5
    want: false
