version: "3.9"
services:
  qdrant:
    image: qdrant/qdrant:latest
    restart: unless-stopped
    ports: ["6333:6333"]
    volumes:
      - qdrant_storage:/qdrant/storage
  retrieval:
    build:
      context: .
      dockerfile: Dockerfile
    restart: unless-stopped
    environment:
      # üîê change this
      BEARER_TOKEN: "blackroad-super-secret"
      # Qdrant
      QDRANT_URL: "http://qdrant:6333"
      QDRANT_API_KEY: ""
      QDRANT_COLLECTION: "blackroad_docs"
      # Embeddings (all local, via SentenceTransformers)
      EMBEDDING_MODEL: "BAAI/bge-small-en-v1.5"
      EMBEDDING_DEVICE: "cpu"          # "cuda" if GPU is available
      # Chunking
      CHUNK_SIZE: "1000"
      CHUNK_OVERLAP: "200"
      MAX_QUERY_TOP_K: "12"
      # CORS (add your domains if exposing publicly)
      CORS_ALLOW_ORIGINS: "*"
    ports: ["8000:8000"]
    depends_on: [qdrant]
    volumes:
      - hf_cache:/root/.cache/huggingface
volumes:
  qdrant_storage:
  hf_cache:
