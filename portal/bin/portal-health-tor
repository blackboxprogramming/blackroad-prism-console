#!/usr/bin/env bash
set -euo pipefail
ROOT="/home/pi/portal"
HS="/var/lib/tor/portal-health/hostname"
[ -s "$HS" ] || { echo "Tor hidden service not ready. Check 'systemctl status tor'." >&2; exit 2; }
ONION="$(sudo cat "$HS")"
if ! sudo test -s "$HS"; then
  echo "Tor hidden service not ready. Check 'systemctl status tor'." >&2
  exit 2
fi
if ! ONION="$(sudo cat "$HS")"; then
  echo "Unable to read Tor hidden service hostname. Check 'sudo systemctl status tor'." >&2
  exit 3
fi
echo "Onion address: http://$ONION/"
echo "Starting local static server on 127.0.0.1:8088..."
exec "$ROOT/bin/portal-static" 127.0.0.1:8088
