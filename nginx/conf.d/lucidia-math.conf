# Proxy Infinity Math portal
location /math/ {
    proxy_pass http://127.0.0.1:8500/;
    proxy_set_header Host $host;
    try_files $uri @math_fallback;
}

# Cache static artifacts
location ~* ^/math/(.*\.(svg|png|json))$ {
    proxy_cache STATIC;
    proxy_cache_valid 200 1h;
    proxy_pass http://127.0.0.1:8500/$1;
}

# Serve generated outputs directly
location /output/ {
    alias /srv/lucidia-math/output/;
    autoindex on;
}

location @math_fallback {
    proxy_pass http://127.0.0.1:8500/;
}
