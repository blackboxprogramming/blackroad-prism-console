-- Organizations, memberships, invites, audit logs, org-scoped API keys
CREATE TABLE "Organization" ("id" TEXT PRIMARY KEY, "name" TEXT NOT NULL, "createdAt" DATETIME DEFAULT CURRENT_TIMESTAMP);
CREATE TABLE "Membership" ("id" TEXT PRIMARY KEY, "role" TEXT NOT NULL, "userId" TEXT NOT NULL, "orgId" TEXT NOT NULL, "createdAt" DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY("userId") REFERENCES "User"("id") ON DELETE CASCADE, FOREIGN KEY("orgId") REFERENCES "Organization"("id") ON DELETE CASCADE);
CREATE TABLE "Invite" ("id" TEXT PRIMARY KEY, "email" TEXT NOT NULL, "token" TEXT UNIQUE NOT NULL, "orgId" TEXT NOT NULL, "role" TEXT NOT NULL DEFAULT 'member', "createdAt" DATETIME DEFAULT CURRENT_TIMESTAMP, "expiresAt" DATETIME NOT NULL, "acceptedBy" TEXT, FOREIGN KEY("orgId") REFERENCES "Organization"("id") ON DELETE CASCADE);
CREATE TABLE "AuditLog" ("id" TEXT PRIMARY KEY, "orgId" TEXT NOT NULL, "actorId" TEXT, "action" TEXT NOT NULL, "meta" TEXT NOT NULL, "ts" DATETIME DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY("orgId") REFERENCES "Organization"("id") ON DELETE CASCADE);
CREATE TABLE "ApiKey" ("id" TEXT PRIMARY KEY, "key" TEXT UNIQUE NOT NULL, "owner" TEXT NOT NULL, "orgId" TEXT NOT NULL, "createdAt" DATETIME DEFAULT CURRENT_TIMESTAMP, "revokedAt" DATETIME, FOREIGN KEY("orgId") REFERENCES "Organization"("id") ON DELETE CASCADE);
