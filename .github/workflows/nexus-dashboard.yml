name: Codex Nexus Dashboard QA
on:
  push:
    paths:
      - "dash/**"
      - "codex_prompts/**"
      - "codex_logs/**"
jobs:
  lint-and-smoke:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Backend deps
        run: pip install fastapi uvicorn pyyaml
      - name: API smoke
        run: |
          python - <<'PY'
          import json
          from fastapi.testclient import TestClient
          from dash.api.main import app
          client = TestClient(app)
          resp = client.get("/health")
          assert resp.status_code == 200
          body = resp.json()
          assert body.get("ok")
          print("api ok")
          PY
      - name: Web build
        working-directory: dash/web
        run: |
          npm ci || npm i
          npm run build
