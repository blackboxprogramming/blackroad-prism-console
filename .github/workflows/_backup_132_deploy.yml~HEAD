name: deploy
on:
  push:
    branches: [ main ]
concurrency:
  group: deploy-prod-${{ github.ref }}
  cancel-in-progress: true
permissions: {}
jobs:
  deploy:
    runs-on: ubuntu-24.04
    steps:
      - name: Checkout (full history required for push)
        uses: actions/checkout@08eba0b27e820071cde6df949e0beb9ba4906955 # v4
        with: { fetch-depth: 0 }

      - name: Deploy to Dokku
        uses: dokku/github-action@v1.8.0
        with:
          git_remote_url: "ssh://dokku@${{ secrets.DOKKU_HOST }}:22/blackroad"
          branch: "main"
          ssh_private_key: ${{ secrets.SSH_PRIVATE_KEY }}
          ssh_host_key: ${{ secrets.SSH_HOST_KEY }}
          # enable verbose client logs if needed:
          # git_push_flags: "-vvv"

