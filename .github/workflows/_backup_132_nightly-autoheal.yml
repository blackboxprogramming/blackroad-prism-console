name: Nightly Auto-Heal
on:
  schedule: [ { cron: "7 5 * * *" } ]  # daily 05:07 UTC
  workflow_dispatch: {}
permissions:
  contents: write
jobs:
  sweep:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@08eba0b27e820071cde6df949e0beb9ba4906955 # v4
        with: { persist-credentials: false, fetch-depth: 0 }
      - name: Run fixer
        run: bash fix-everything.sh
      - name: Push changes (if any)
        env: { BOT_TOKEN: ${{ secrets.BOT_TOKEN }} }
        run: |
          if ! git diff --quiet HEAD^ HEAD 2>/dev/null; then
            BR="$(git rev-parse --abbrev-ref HEAD)"
            [ -n "$BOT_TOKEN" ] && git push "https://${BOT_TOKEN}@github.com/${{ github.repository }}.git" "HEAD:${BR}" || echo "::notice::No BOT_TOKEN; not pushing."
          else
            echo "No changes to push."
          fi
