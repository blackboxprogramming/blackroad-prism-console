name: ChatOps: Deploy Staging
on: { issue_comment: { types: [created] } }
permissions: { actions: write, pull-requests: write }
jobs:
  deploy:
    if: startsWith(github.event.comment.body, '/deploy blackroad staging')
    runs-on: ubuntu-latest
    steps:
      - uses: actions/github-script@v7
        with:
          script: |
            try {
              await github.actions.createWorkflowDispatch({
                owner: context.repo.owner, repo: context.repo.repo,
                workflow_id: 'deploy-blackroad-staging.yml',
                ref: 'staging'
              });
              await github.issues.createComment({owner: context.repo.owner, repo: context.repo.repo, issue_number: context.payload.issue.number, body: "ðŸš¦ Staging deploy dispatched."});
            } catch(e) {
              await github.issues.createComment({owner: context.repo.owner, repo: context.repo.repo, issue_number: context.payload.issue.number, body: "Failed to dispatch staging: " + e.message});
            }
