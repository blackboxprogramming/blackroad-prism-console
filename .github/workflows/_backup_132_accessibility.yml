name: Accessibility + SEO (advisory)
on:
  pull_request:
    paths: ['sites/blackroad/**']
  workflow_dispatch:
permissions: { contents: read }
jobs:
  checks:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@08eba0b27e820071cde6df949e0beb9ba4906955 # v4
      - uses: actions/setup-node@v4
        with: { node-version: 20 }
      - run: |
          cd sites/blackroad
          npm ci --omit=optional || npm i --package-lock-only
          npm i -D @axe-core/cli lighthouse
          npm run build
          npx http-server dist -p 4179 -s & sleep 2
          npx axe http://127.0.0.1:4179 --exit 0 || true
          npx lighthouse http://127.0.0.1:4179 --preset=desktop --quiet --chrome-flags="--headless" --output html --output-path ../artifacts/lh.html || true
      - uses: actions/upload-artifact@ea165f8d65b6e75b540449e92b4886f43607fa02 # v4
        with: { name: a11y-seo, path: sites/blackroad/artifacts/** }
