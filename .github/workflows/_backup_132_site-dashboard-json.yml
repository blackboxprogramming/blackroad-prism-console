name: Site Dashboard JSON
on:
  push:
    branches: [ main ]
  workflow_dispatch:
permissions: { contents: write }
jobs:
  dash:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@08eba0b27e820071cde6df949e0beb9ba4906955 # v4
      - name: Update deploy dashboard JSON
        run: |
          mkdir -p sites/blackroad/public
          node -e "const fs=require('fs');const p='sites/blackroad/public/status.json'; const s={ ts:new Date().toISOString(), ref:'${{ github.sha }}', run:${{ github.run_id }} }; fs.writeFileSync(p, JSON.stringify(s,null,2));"
          git add sites/blackroad/public/status.json
          git diff --staged --quiet || (git config user.name  "${{ secrets.BOT_USER || 'blackroad-bot' }}"; git config user.email "${{ secrets.BOT_USER || 'blackroad-bot' }}@users.noreply.github.com"; git commit -m "chore(site): update status.json"; git push || true)
