name: Codex Bridge
on: { issue_comment: { types: [created] } }
permissions: { contents: write, pull-requests: write, issues: write }
jobs:
  apply:
    if: |
      startsWith(github.event.comment.body, '/codex ')
      || startsWith(github.event.comment.body, '@codex')
      || startsWith(github.event.comment.body, '@cadillac')
      || startsWith(github.event.comment.body, '@Cadillac')
      || startsWith(github.event.comment.body, '@lucidia')
      || startsWith(github.event.comment.body, '@Lucidia')
      || startsWith(github.event.comment.body, '@bbpteam')
      || startsWith(github.event.comment.body, '@BBPTeam')
      || startsWith(github.event.comment.body, '@blackboxprogramming')
      || startsWith(github.event.comment.body, '@Blackboxprogramming')
    runs-on: ubuntu-latest
    env:
      BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
      BOT_USER: ${{ secrets.BOT_USER || 'blackroad-bot' }}
      CODEX_BODY: ${{ github.event.comment.body }}
      CODEX_PERMISSION: ${{ github.event.comment.author_association }}
    steps:
      - uses: actions/checkout@v4
        with: { persist-credentials: false, fetch-depth: 0 }
      - uses: actions/setup-node@v4
        with: { node-version: 20 }
      - run: node .github/tools/codex-apply.js
      - uses: actions/github-script@v7
        with:
          script: |
            await github.issues.createComment({owner: context.repo.owner, repo: context.repo.repo, issue_number: context.payload.issue.number, body: "ðŸ§© Codex Bridge applied/updated (or skipped safely)."});
