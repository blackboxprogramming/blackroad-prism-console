name: Repo Doctor
on:
  workflow_dispatch:
  schedule: [{ cron: '37 4 * * *' }] # daily 04:37 UTC
jobs:
  doctor:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@08eba0b27e820071cde6df949e0beb9ba4906955 # v4
        with: { fetch-depth: 0 }
      - name: Install tidy-html5 (for HTML lint)
        run: sudo apt-get update && sudo apt-get install -y tidy
      - name: Run doctor
        run: |
          ./.tools/doctor/repo-doctor.sh repo-doctor-report.md
      - name: Upload logs
        if: always()
        uses: actions/upload-artifact@ea165f8d65b6e75b540449e92b4886f43607fa02 # v4
        with:
          name: repo-doctor
          path: |
            repo-doctor-report.md
            tidy.log
      - name: Summarize
        run: |
          echo "### Repo Doctor" >> $GITHUB_STEP_SUMMARY
          sed -n '1,200p' repo-doctor-report.md >> $GITHUB_STEP_SUMMARY
