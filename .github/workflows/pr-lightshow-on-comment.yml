name: pr-lightshow-on-comment
on:
  issue_comment:
    types: [created]
permissions:
  contents: read
  pull-requests: read
jobs:
  lightshow:
    if: >
      contains(github.event.comment.body, 'athena play') ||
      contains(github.event.comment.body, '/lightshow')
    # Prefer your self-hosted runner on the API host (loopback allowed)
    runs-on: [self-hosted, linux, blackroad]
    steps:
      - uses: actions/checkout@08eba0b27e820071cde6df949e0beb9ba4906955 # v4

      - name: Ensure jq is present
        run: |
          command -v jq || (sudo apt-get update && sudo apt-get install -y jq)

      - name: Run PR lightshow
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          OWNER: ${{ github.repository_owner }}
          REPO: ${{ github.event.repository.name }}
          PR: ${{ github.event.issue.number }}
          # Optional: override LED_BASE if runner is remote from API
          # LED_BASE: https://blackroad.io
        run: |
          bash scripts/led/pr_lightshow.sh
