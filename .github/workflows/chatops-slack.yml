name: ChatOps â†’ Slack
on: { issue_comment: { types: [created] } }
permissions: { contents: read }
jobs:
  say:
    if: startsWith(github.event.comment.body, '/slack ')
    runs-on: ubuntu-latest
    steps:
      - name: Send to Slack
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
          TEXT: ${{ github.event.comment.body }}
          USER: ${{ github.event.comment.user.login }}
        run: |
          if [ -z "$SLACK_WEBHOOK_URL" ]; then
            echo "No SLACK_WEBHOOK_URL"; exit 0;
          fi
          msg="$(echo "$TEXT" | sed 's:^/slack ::')"
          curl -X POST -H 'Content-type: application/json' --data "{\"text\":\"*$USER* says: $msg\"}" "$SLACK_WEBHOOK_URL"
