name: Register GitHubâ†’Matomo Webhook
on:
  workflow_dispatch:
  push:
    branches: [ main ]
jobs:
  hook:
    runs-on: ubuntu-latest
    steps:
      - name: Register webhook
        env:
          GITHUB_PAT: ${{ secrets.GITHUB_PAT }}
        run: |
          REPO="${GITHUB_REPOSITORY}"
          curl -H "Authorization: token $GITHUB_PAT" \
            -H "Accept: application/vnd.github+json" \
            https://api.github.com/repos/$REPO/hooks \
            -d '{"config":{"url":"https://blackroad.io/webhooks/matomo","content_type":"json"},"events":["push","issues","pull_request"]}'
