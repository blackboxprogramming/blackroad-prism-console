name: Codex Bot Router
on:
  issue_comment:
    types: [created]
permissions:
  contents: write
  pull-requests: write
jobs:
  route:
    if: contains(github.event.comment.body, '@codex fix')
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
      - run: pip install ruamel.yaml toml
      - name: Apply requested fixes
        env:
          COMMENT: ${{ github.event.comment.body }}
          PR_NUMBER: ${{ github.event.issue.number }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_PAT }}
        run: |
          python scripts/comment_router.py "$COMMENT"
          git config user.email "bot@blackroad.io"
          git config user.name "BlackRoad Codex Bot"
          git add -A
          git commit -m "bot: apply @codex request on PR #$PR_NUMBER" || echo "no changes"
          git push
